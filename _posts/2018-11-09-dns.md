---
layout: post
title: Linux 在shell终端中清空DNS缓存,刷新DNS的方法(ubuntu,debian)
categories: [Linux]
description: ""
keywords: Linux, DNS, ubuntu, debian
---

此文首发于我的个人博客：[zhang0peter的个人博客](https://zhang0peter.com)         

{% raw %}
***          
{% endraw %}



## 前言
在Linux系统里查询DNS使用如下命令
```bash
dig baidu.com @114.114.114.114
```
或者使用系统默认的DNS服务器查询
```bash
nslookup baidu.com
```
**下文中的方法不一定全管用，但你总能找到管用的一个**
## 1.network-manager and networking 
在一些Linux操作系统里，如ubuntu的特定版本，DNS是由network-manager这个系统服务管理的。

在这些系统里，需要运行命令：
```bash
sudo service network-manager restart
```
在其他系统中可以使用命令：
```bash
sudo service networking restart
```
## 2.ubuntu
在Ubuntu12.04中可以尝试如下命令:
```bash
sudo kill -HUP $(pgrep dnsmasq)
```
在Ubuntu 16.04和debian 9中，你可以使用如下命令刷新DNS
```bash
sudo systemd-resolve --statistics
```
在Ubuntu17.04和更高版本上，使用如下命令：
```bash
sudo systemd-resolve --flush-caches
```
## 3 /etc/resolv.conf
/etc/resolv.conf这个文件里存放的是DNS服务器的地址，直接修改这个文件只能暂时改变默认DNS的地址，重启后恢复设置。

你可以直接修改这个文件用来临时使用：
```bash
# Dynamic resolv.conf(5) file for glibc resolver(3) generated by resolvconf(8)
#     DO NOT EDIT THIS FILE BY HAND -- YOUR CHANGES WILL BE OVERWRITTEN
nameserver 8.8.8.8
```
修改完成后重新ping或者nslookup就会从新的DNS服务器那里得到IP地址

永久修改的方法见：[How do I add a DNS server via resolv.conf?](https://askubuntu.com/questions/130452/how-do-i-add-a-dns-server-via-resolv-conf)
## 4.nscd 
nscd是一个很好用的DNS缓存服务，使用如下命令安装：
```bash
apt install nscd  #debian ubuntu
```
如果你的Linux系统安装了nscd ，那么可以使用如下命令刷新DNS：
```bash
sudo /etc/init.d/nscd restart
```

参考资料：
[How do I clear the DNS cache?](https://askubuntu.com/questions/2219/how-do-i-clear-the-dns-cache/929478#929478)

[Flush DNS Cache in Ubuntu](https://chrisjean.com/flush-dns-cache-in-ubuntu/)
