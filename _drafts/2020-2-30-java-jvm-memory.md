---
layout: post
title: "Java-JVM内存布局详解"
categories: [Java]
description: ""
keywords: Java
---

此文首发于我的Jekyll博客：[zhang0peter的个人博客](https://zhang0peter.com)         

{% raw %}
***          
{% endraw %}


JVM 内存区域划分更加细致，分为：

堆
方法区
虚拟机栈
本地方法栈
程序计数器

其中 堆和方法区是所有线程共享的，而虚拟机栈，本地方法栈，程序计数器是线程私有的。

程序计算器可以说是这几块区域占用最小的一部分，但是功能却十分重要。Java 源代码通过编译变成字节码，然后被 JVM 载入运行之后，将会变成一条条指令，而程序计数器的工作就是告诉当前线程下一条需要执行指令。这样即使发生了线程切换，等待恢复的时候，当前线程依然知道接下去要执行的指令。


## 堆 heap
JVM管理的内存中堆内存是最大的一块

垃圾收集一般是针对的用于存放对象的 堆内存 ，所以堆内存有时候也会被称为GC堆

从内存分配的角度上来说，堆内存中包含了新生代内存和老年代内存，而年轻代又分为Eden和Survivor区。Survivor区由From Survivor和To Survivor组成。Eden区占大容量，Survivor两个区占小容量，默认比例是8:1:1，而且JVM 每次只会使用 Eden 和其中的一块 Survivor 区域来为对象服务，所以无论什么时候，总是有一块 Survivor 区域是空闲着的。

## 方法区-元空间
方法区存储虚拟机加载的 类信息 ， 常量 ， 静态变量 ，即时编译器 编译后的代码 等数据

在JDK 8 之前，方法区被称为(或者可以说是被实现为)持久代，永久代（Perman Gen），而在 JDK 8 之后，取消了永久代的概念，取而代之的实现是元空间（MetaSpace），原本位于永久代中的运行时常量池和静态变量都存储到了堆中，而其余的内容则是移到了元空间。

元空间的本质和永久代类似，都是对JVM规范中 方法区的实现 ，它们之间最大的区别在于： 元空间并不在虚拟机中，而是使用本地内存

字符串常量池 从JDK 7 之后就移到了堆内存中去管理，但是运行时常量是仍然位于方法区基于JDK 8 的新实现——元空间中。



