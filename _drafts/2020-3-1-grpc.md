---
layout: post
title: "grpc静态编译与使用"
categories: [rpc]
description: ""
---

此文首发于我的Jekyll博客：[zhang0peter的个人博客](https://zhang0peter.com)         

{% raw %}
***          
{% endraw %}

最近要用到`grpc`，因此写一篇关于 grpc 静态编译和使用的文章

## 下载
安装需要的软件：
```sh
apt install make gcc g++ cmake build-essential autoconf libtool pkg-config git
```
下载库：
```sh
git clone https://github.com/grpc/grpc.git
cd grpc
git submodule update --init --recursive
```

## 安装 protobuf-protoc
google的grpc使用的`protobuf`作为序列化数据的格式。

可以直接安装`protoc`
```sh
apt install libprotobuf-dev protobuf-compiler-grpc
```
库中的`protoc`版本比较旧：
```sh
-> # protoc --version
libprotoc 3.0.0
```
或者安装刚才编译的`protobuf`也可:
```sh
cd third_party/protobuf
make check
sudo make install
sudo ldconfig # refresh shared library cache.
```
```sh
-> # protoc --version
libprotoc 3.11.2
```


## 静态编译 grpc/ static link build grpc


```sh
export CFLAGS='-Wno-implicit-fallthrough'
export CXXFLAGS='-Wno-expansion-to-defined -Wno-implicit-fallthrough'
make REQUIRE_CUSTOM_LIBRARIES_opt=1 static
```
注意：如果安装`grpc`到系统目录后，无法轻易卸载

```sh
sudo make install
```



## 测试

```sh
cd examples/cpp/helloworld 
```





